{"ast":null,"code":"import _slicedToArray from \"C:\\\\Users\\\\Devin\\\\AOT_Projects\\\\forms-flow-master\\\\forms-flow-ai\\\\forms-flow-web\\\\node_modules\\\\@babel\\\\runtime\\\\helpers\\\\esm\\\\slicedToArray.js\";\n\nvar _jsxFileName = \"C:\\\\Users\\\\Devin\\\\AOT_Projects\\\\forms-flow-master\\\\forms-flow-ai\\\\forms-flow-web\\\\src\\\\components\\\\Form\\\\Item\\\\Submission\\\\List.js\",\n    _this = this,\n    _s = $RefreshSig$();\n\nimport React, { useEffect, useState } from 'react';\nimport { Link, useParams } from 'react-router-dom';\nimport { connect, useDispatch, useSelector } from 'react-redux';\nimport { push } from 'connected-react-router';\nimport { getSubmissions as _getSubmissions, selectRoot, selectError, SubmissionGrid, Errors, deleteSubmission } from 'react-formio';\nimport cloneDeep from 'lodash/cloneDeep';\nimport Loading from '../../../../containers/Loading';\nimport { OPERATIONS, CLIENT, STAFF_REVIEWER } from '../../../../constants/constants';\nimport Confirm from '../../../../containers/Confirm';\nimport { setFormSubmissionDeleteStatus } from '../../../../actions/formActions';\nimport { getAllApplicationsByFormId } from \"../../../../apiManager/services/applicationServices\";\nimport { addApplicationDetailsToFormComponent, getRelevantApplications } from \"../../../../apiManager/services/formatterService\";\nimport { defaultSubmissionData } from \"../../../../constants/submissionConstants\";\nimport { setApplicationListLoader } from \"../../../../actions/applicationActions\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nvar getOperations = function getOperations(userRoles) {\n  var operations = [];\n\n  if (userRoles.includes(STAFF_REVIEWER)) {\n    operations.push(OPERATIONS.view\n    /*, OPERATIONS.deleteSubmission*/\n    );\n  } else if (userRoles.includes(CLIENT)) {\n    operations.push(OPERATIONS.view);\n  }\n\n  return operations;\n};\n\nvar List = /*#__PURE__*/React.memo(_c = _s(function (props) {\n  _s();\n\n  var dispatch = useDispatch();\n\n  var _useParams = useParams(),\n      formId = _useParams.formId;\n\n  var submissions = props.submissions,\n      isLoading = props.isLoading,\n      onAction = props.onAction,\n      getSubmissions = props.getSubmissions,\n      errors = props.errors,\n      userRoles = props.userRoles,\n      submissionFormId = props.submissionFormId,\n      submissionId = props.submissionId,\n      _onNo = props.onNo,\n      _onYes = props.onYes;\n  var operations = getOperations(userRoles);\n  var formApplicationsList = useSelector(function (state) {\n    return state.applications.formApplicationsList;\n  });\n  var isApplicationsListLoading = useSelector(function (state) {\n    return state.applications.isApplicationListLoading;\n  });\n  var form = useSelector(function (state) {\n    return state.form.form;\n  });\n\n  var _useState = useState(),\n      _useState2 = _slicedToArray(_useState, 2),\n      formData = _useState2[0],\n      setFormData = _useState2[1];\n\n  var _useState3 = useState(defaultSubmissionData),\n      _useState4 = _slicedToArray(_useState3, 2),\n      submissionListData = _useState4[0],\n      setSubmissionListData = _useState4[1];\n\n  useEffect(function () {\n    dispatch(setApplicationListLoader(true));\n    dispatch(getAllApplicationsByFormId(formId));\n    getSubmissions(1);\n  }, [getSubmissions, dispatch, formId]);\n  useEffect(function () {\n    if (form && form.components) {\n      setFormData(addApplicationDetailsToFormComponent(cloneDeep(form)));\n    }\n  }, [form, setFormData]);\n  useEffect(function () {\n    if (formApplicationsList.length && submissions) {\n      var updatedSubmissionList = getRelevantApplications(formApplicationsList, cloneDeep(submissions));\n      setSubmissionListData(updatedSubmissionList);\n    }\n  }, [formApplicationsList, submissions, setSubmissionListData]); //TODO add formApplicationLoader\n\n  if (isLoading || isApplicationsListLoading) {\n    return /*#__PURE__*/_jsxDEV(Loading, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 67,\n      columnNumber: 7\n    }, _this);\n  }\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"container\",\n    children: [/*#__PURE__*/_jsxDEV(Confirm, {\n      modalOpen: props.modalOpen,\n      message: \"Are you sure you wish to delete this submission?\",\n      onNo: function onNo() {\n        return _onNo();\n      },\n      onYes: function onYes() {\n        return _onYes(submissionFormId, submissionId, submissions);\n      }\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 73,\n      columnNumber: 7\n    }, _this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"main-header\",\n      children: [/*#__PURE__*/_jsxDEV(Link, {\n        className: \"back-icon\",\n        to: \"/form\",\n        children: /*#__PURE__*/_jsxDEV(\"i\", {\n          className: \"fa fa-chevron-left fa-lg\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 81,\n          columnNumber: 9\n        }, _this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 80,\n        columnNumber: 9\n      }, _this), /*#__PURE__*/_jsxDEV(\"h3\", {\n        className: \"ml-3\",\n        children: [/*#__PURE__*/_jsxDEV(\"span\", {\n          className: \"task-head-details\",\n          children: [\" \", /*#__PURE__*/_jsxDEV(\"i\", {\n            className: \"fa fa-wpforms\",\n            \"aria-hidden\": \"true\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 87,\n            columnNumber: 48\n          }, _this), /*#__PURE__*/_jsxDEV(\"span\", {\n            className: \"forms-text\",\n            children: \"Forms /\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 87,\n            columnNumber: 97\n          }, _this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 87,\n          columnNumber: 11\n        }, _this), \" \", form.title]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 86,\n        columnNumber: 9\n      }, _this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 79,\n      columnNumber: 7\n    }, _this), /*#__PURE__*/_jsxDEV(\"section\", {\n      className: \"custom-grid\",\n      children: [/*#__PURE__*/_jsxDEV(Errors, {\n        errors: errors\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 95,\n        columnNumber: 9\n      }, _this), formData && /*#__PURE__*/_jsxDEV(SubmissionGrid, {\n        submissions: submissionListData,\n        form: formData,\n        onAction: onAction,\n        getSubmissions: getSubmissions,\n        operations: operations\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 96,\n        columnNumber: 22\n      }, _this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 94,\n      columnNumber: 7\n    }, _this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 72,\n    columnNumber: 5\n  }, _this);\n}, \"Vx4b9isSuKfIgtynrrAuMNDJh0E=\", false, function () {\n  return [useDispatch, useParams, useSelector, useSelector, useSelector];\n}));\n_c2 = List;\n\nvar mapStateToProps = function mapStateToProps(state) {\n  var form = selectRoot('form', state);\n  var submissions = selectRoot('submissions', state);\n  return {\n    submissions: submissions,\n    isLoading: form.isActive || submissions.isActive,\n    errors: [selectError('submissions', state), selectError('form', state)],\n    userRoles: selectRoot('user', state).roles || [],\n    modalOpen: selectRoot('formDelete', state).formSubMissionDelete.modalOpen,\n    submissionFormId: selectRoot('formDelete', state).formSubMissionDelete.formId,\n    submissionId: selectRoot('formDelete', state).formSubMissionDelete.submissionId\n  };\n};\n\nvar mapDispatchToProps = function mapDispatchToProps(dispatch, ownProps) {\n  return {\n    getSubmissions: function getSubmissions(page, query) {\n      return dispatch(_getSubmissions('submissions', page, query, ownProps.match.params.formId));\n    },\n    onAction: function onAction(submission, action) {\n      switch (action) {\n        case 'viewSubmission':\n          dispatch(push(\"/form/\".concat(ownProps.match.params.formId, \"/submission/\").concat(submission._id)));\n          break;\n\n        case 'edit':\n          dispatch(push(\"/form/\".concat(ownProps.match.params.formId, \"/submission/\").concat(submission._id, \"/edit\")));\n          break;\n\n        case 'delete':\n          var submissionDetails = {\n            modalOpen: true,\n            formId: ownProps.match.params.formId,\n            submissionId: submission._id\n          };\n          dispatch(setFormSubmissionDeleteStatus(submissionDetails));\n          break;\n\n        default:\n      }\n    },\n    onYes: function onYes(formId, submissionId, submissions) {\n      dispatch(deleteSubmission('submission', submissionId, formId, function (err) {\n        if (!err) {\n          var submissionDetails = {\n            modalOpen: false,\n            submissionId: \"\",\n            formId: \"\"\n          };\n          dispatch(setFormSubmissionDeleteStatus(submissionDetails));\n          dispatch(_getSubmissions('submissions', 1, submissions.query, ownProps.match.params.formId));\n        }\n      }));\n    },\n    onNo: function onNo() {\n      var submissionDetails = {\n        modalOpen: false,\n        submissionId: \"\",\n        formId: \"\"\n      };\n      dispatch(setFormSubmissionDeleteStatus(submissionDetails));\n    }\n  };\n};\n\nexport default connect(mapStateToProps, mapDispatchToProps)(List);\n\nvar _c, _c2;\n\n$RefreshReg$(_c, \"List$React.memo\");\n$RefreshReg$(_c2, \"List\");","map":{"version":3,"sources":["C:/Users/Devin/AOT_Projects/forms-flow-master/forms-flow-ai/forms-flow-web/src/components/Form/Item/Submission/List.js"],"names":["React","useEffect","useState","Link","useParams","connect","useDispatch","useSelector","push","getSubmissions","selectRoot","selectError","SubmissionGrid","Errors","deleteSubmission","cloneDeep","Loading","OPERATIONS","CLIENT","STAFF_REVIEWER","Confirm","setFormSubmissionDeleteStatus","getAllApplicationsByFormId","addApplicationDetailsToFormComponent","getRelevantApplications","defaultSubmissionData","setApplicationListLoader","getOperations","userRoles","operations","includes","view","List","memo","props","dispatch","formId","submissions","isLoading","onAction","errors","submissionFormId","submissionId","onNo","onYes","formApplicationsList","state","applications","isApplicationsListLoading","isApplicationListLoading","form","formData","setFormData","submissionListData","setSubmissionListData","components","length","updatedSubmissionList","modalOpen","title","mapStateToProps","isActive","roles","formSubMissionDelete","mapDispatchToProps","ownProps","page","query","match","params","submission","action","_id","submissionDetails","err"],"mappings":"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","sourcesContent":["import React, {useEffect, useState} from 'react';\r\nimport {Link, useParams} from 'react-router-dom'\r\nimport {connect, useDispatch, useSelector} from 'react-redux';\r\nimport {push} from 'connected-react-router';\r\nimport {getSubmissions, selectRoot, selectError, SubmissionGrid, Errors, deleteSubmission} from 'react-formio';\r\nimport cloneDeep from 'lodash/cloneDeep';\r\n\r\nimport Loading from '../../../../containers/Loading';\r\nimport {OPERATIONS, CLIENT, STAFF_REVIEWER} from '../../../../constants/constants';\r\nimport Confirm from '../../../../containers/Confirm';\r\nimport {setFormSubmissionDeleteStatus} from '../../../../actions/formActions'\r\nimport {getAllApplicationsByFormId} from \"../../../../apiManager/services/applicationServices\";\r\nimport {\r\n  addApplicationDetailsToFormComponent,\r\n  getRelevantApplications\r\n} from \"../../../../apiManager/services/formatterService\";\r\nimport {defaultSubmissionData} from \"../../../../constants/submissionConstants\";\r\nimport {setApplicationListLoader} from \"../../../../actions/applicationActions\";\r\n\r\n\r\n\r\nconst getOperations = (userRoles) => {\r\n  let operations = [];\r\n  if (userRoles.includes(STAFF_REVIEWER)) {\r\n    operations.push(OPERATIONS.view/*, OPERATIONS.deleteSubmission*/)\r\n  }else if (userRoles.includes(CLIENT)) {\r\n    operations.push(OPERATIONS.view)\r\n  }\r\n  return operations;\r\n}\r\n\r\nconst List = React.memo((props) => {\r\n  const dispatch = useDispatch();\r\n  const {formId} = useParams();\r\n  const {submissions, isLoading, onAction, getSubmissions, errors, userRoles, submissionFormId, submissionId, onNo, onYes} = props;\r\n  const operations = getOperations(userRoles);\r\n  const formApplicationsList = useSelector((state) => state.applications.formApplicationsList);\r\n  const isApplicationsListLoading = useSelector((state) => state.applications.isApplicationListLoading);\r\n  const form = useSelector((state)=>state.form.form);\r\n  const [formData, setFormData] = useState();\r\n  const [submissionListData, setSubmissionListData] = useState(defaultSubmissionData);\r\n\r\n  useEffect(() => {\r\n    dispatch(setApplicationListLoader(true))\r\n    dispatch(getAllApplicationsByFormId(formId));\r\n    getSubmissions(1);\r\n  }, [getSubmissions, dispatch, formId ]);\r\n\r\n  useEffect(()=>{\r\n     if(form && form.components){\r\n       setFormData(addApplicationDetailsToFormComponent(cloneDeep(form)))\r\n     }\r\n  },[ form, setFormData ]);\r\n\r\n  useEffect(()=>{\r\n    if(formApplicationsList.length && submissions){\r\n      let updatedSubmissionList = getRelevantApplications(formApplicationsList,cloneDeep(submissions));\r\n      setSubmissionListData(updatedSubmissionList);\r\n    }\r\n  },[formApplicationsList,submissions, setSubmissionListData])\r\n\r\n\r\n\r\n//TODO add formApplicationLoader\r\n  if (isLoading || isApplicationsListLoading) {\r\n    return (\r\n      <Loading/>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"container\">\r\n      <Confirm modalOpen={props.modalOpen}\r\n               message=\"Are you sure you wish to delete this submission?\"\r\n               onNo={() => onNo()}\r\n               onYes={() => onYes(submissionFormId, submissionId, submissions)}\r\n      >\r\n      </Confirm>\r\n      <div className=\"main-header\">\r\n        <Link className=\"back-icon\" to=\"/form\">\r\n        <i className=\"fa fa-chevron-left fa-lg\" />\r\n        </Link>\r\n{/*        <span className=\"ml-3\">\r\n                        <img src=\"/form.svg\" width=\"30\" height=\"30\" alt=\"form\" />\r\n                    </span>*/}\r\n        <h3 className=\"ml-3\">\r\n          <span className=\"task-head-details\"> <i className=\"fa fa-wpforms\" aria-hidden=\"true\"/><span className=\"forms-text\">Forms /</span></span> {form.title}\r\n        </h3>\r\n        {/* {userRoles.includes(CLIENT) ? <Link className=\"btn btn-primary form-btn btn-right\" to={`/form/${formId}`}>\r\n        <img src=\"/webfonts/fa_plus.svg\" alt=\"back\"/> New Submisssion\r\n        </Link> : null} */}\r\n      </div>\r\n\r\n      <section className=\"custom-grid\">\r\n        <Errors errors={errors}/>\r\n        {formData && <SubmissionGrid\r\n          submissions={submissionListData}\r\n          form={formData}\r\n          onAction={onAction}\r\n          getSubmissions={getSubmissions}\r\n          operations={operations}\r\n        />}\r\n      </section>\r\n    </div>\r\n  );\r\n})\r\n\r\nconst mapStateToProps = (state) => {\r\n  const form = selectRoot('form', state);\r\n  const submissions = selectRoot('submissions', state);\r\n  return {\r\n    submissions: submissions,\r\n    isLoading: form.isActive || submissions.isActive,\r\n    errors: [\r\n      selectError('submissions', state),\r\n      selectError('form', state)\r\n    ],\r\n    userRoles: selectRoot('user', state).roles || [],\r\n    modalOpen: selectRoot('formDelete', state).formSubMissionDelete.modalOpen,\r\n    submissionFormId: selectRoot('formDelete', state).formSubMissionDelete.formId,\r\n    submissionId: selectRoot('formDelete', state).formSubMissionDelete.submissionId\r\n  };\r\n};\r\nconst mapDispatchToProps = (dispatch, ownProps) => {\r\n  return {\r\n    getSubmissions: (page, query) => dispatch(getSubmissions('submissions', page, query, ownProps.match.params.formId)),\r\n    onAction: (submission, action) => {\r\n      switch (action) {\r\n        case 'viewSubmission':\r\n          dispatch(push(`/form/${ownProps.match.params.formId}/submission/${submission._id}`));\r\n          break;\r\n        case 'edit':\r\n          dispatch(push(`/form/${ownProps.match.params.formId}/submission/${submission._id}/edit`));\r\n          break;\r\n        case 'delete':\r\n          const submissionDetails = {\r\n            modalOpen: true,\r\n            formId: ownProps.match.params.formId,\r\n            submissionId: submission._id\r\n          }\r\n          dispatch(setFormSubmissionDeleteStatus(submissionDetails))\r\n          break;\r\n        default:\r\n      }\r\n    },\r\n    onYes: (formId, submissionId, submissions) => {\r\n      dispatch(deleteSubmission('submission', submissionId, formId, (err) => {\r\n        if (!err) {\r\n          const submissionDetails = {modalOpen: false, submissionId: \"\", formId: \"\"}\r\n          dispatch(setFormSubmissionDeleteStatus(submissionDetails))\r\n          dispatch(getSubmissions('submissions', 1, submissions.query, ownProps.match.params.formId))\r\n        }\r\n      }));\r\n    },\r\n    onNo: () => {\r\n      const submissionDetails = {modalOpen: false, submissionId: \"\", formId: \"\"}\r\n      dispatch(setFormSubmissionDeleteStatus(submissionDetails))\r\n    }\r\n  };\r\n};\r\n\r\nexport default connect(\r\n  mapStateToProps,\r\n  mapDispatchToProps\r\n)(List)\r\n"]},"metadata":{},"sourceType":"module"}