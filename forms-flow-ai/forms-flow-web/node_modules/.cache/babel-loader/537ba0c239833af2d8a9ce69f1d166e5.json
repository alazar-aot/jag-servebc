{"ast":null,"code":"import _objectSpread from \"C:\\\\Users\\\\Devin\\\\AOT_Projects\\\\jag-servebc\\\\forms-flow-ai\\\\forms-flow-web\\\\node_modules\\\\@babel\\\\runtime\\\\helpers\\\\esm\\\\objectSpread2.js\";\n\nvar _jsxFileName = \"C:\\\\Users\\\\Devin\\\\AOT_Projects\\\\jag-servebc\\\\forms-flow-ai\\\\forms-flow-web\\\\src\\\\components\\\\Form\\\\Item\\\\Submission\\\\Item\\\\Edit.js\",\n    _this = this,\n    _s = $RefreshSig$();\n\nimport React, { useEffect } from 'react';\nimport { connect, useDispatch, useSelector } from 'react-redux';\nimport { selectRoot, resetSubmissions, saveSubmission, Form, selectError, Errors } from 'react-formio';\nimport { push } from 'connected-react-router';\nimport Loading from '../../../../../containers/Loading';\nimport { setFormSubmissionError, setFormSubmissionLoading } from '../../../../../actions/formActions';\nimport SubmissionError from '../../../../../containers/SubmissionError';\nimport { getUserRolePermission } from \"../../../../../helper/user\";\nimport { CLIENT } from \"../../../../../constants/constants\";\nimport { CLIENT_EDIT_STATUS, UPDATE_EVENT_STATUS, getProcessDataReq } from \"../../../../../constants/applicationConstants\";\nimport { useParams } from \"react-router-dom\";\nimport { updateApplicationEvent } from \"../../../../../apiManager/services/applicationServices\";\nimport LoadingOverlay from \"react-loading-overlay\";\nimport { toast } from \"react-toastify\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nvar Edit = /*#__PURE__*/React.memo(_c = _s(function (props) {\n  _s();\n\n  var dispatch = useDispatch();\n\n  var _useParams = useParams(),\n      formId = _useParams.formId,\n      submissionId = _useParams.submissionId;\n\n  var hideComponents = props.hideComponents,\n      _onSubmit = props.onSubmit,\n      options = props.options,\n      errors = props.errors,\n      onFormSubmit = props.onFormSubmit,\n      onCustomEvent = props.onCustomEvent,\n      _props$form = props.form,\n      form = _props$form.form,\n      isFormActive = _props$form.isActive,\n      _props$submission = props.submission,\n      submission = _props$submission.submission,\n      isSubActive = _props$submission.isActive,\n      url = _props$submission.url;\n  var applicationStatus = useSelector(function (state) {\n    var _state$applications$a;\n\n    return ((_state$applications$a = state.applications.applicationDetail) === null || _state$applications$a === void 0 ? void 0 : _state$applications$a.applicationStatus) || '';\n  });\n  var userRoles = useSelector(function (state) {\n    return selectRoot(\"user\", state).roles;\n  });\n  var applicationDetail = useSelector(function (state) {\n    return state.applications.applicationDetail;\n  });\n  var isFormSubmissionLoading = useSelector(function (state) {\n    return state.formDelete.isFormSubmissionLoading;\n  });\n  useEffect(function () {\n    if (applicationStatus && !onFormSubmit) {\n      if (getUserRolePermission(userRoles, CLIENT) && !CLIENT_EDIT_STATUS.includes(applicationStatus)) {\n        dispatch(push(\"/form/\".concat(formId, \"/submission/\").concat(submissionId)));\n      }\n    }\n  }, [applicationStatus, userRoles, dispatch, submissionId, formId, onFormSubmit]);\n\n  if (isFormActive || isSubActive && !isFormSubmissionLoading) {\n    return /*#__PURE__*/_jsxDEV(Loading, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 51,\n      columnNumber: 14\n    }, _this);\n  }\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"container\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"main-header\",\n      children: [/*#__PURE__*/_jsxDEV(SubmissionError, {\n        modalOpen: props.submissionError.modalOpen,\n        message: props.submissionError.message,\n        onConfirm: props.onConfirm\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 57,\n        columnNumber: 11\n      }, _this), /*#__PURE__*/_jsxDEV(\"h3\", {\n        className: \"task-head\",\n        children: form.title\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 62,\n        columnNumber: 11\n      }, _this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 56,\n      columnNumber: 9\n    }, _this), /*#__PURE__*/_jsxDEV(Errors, {\n      errors: errors\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 64,\n      columnNumber: 9\n    }, _this), /*#__PURE__*/_jsxDEV(LoadingOverlay, {\n      active: isFormSubmissionLoading,\n      spinner: true,\n      text: \"Loading...\",\n      className: \"col-12\",\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"ml-4 mr-4\",\n        children: /*#__PURE__*/_jsxDEV(Form, {\n          form: form,\n          submission: submission,\n          url: url,\n          hideComponents: hideComponents,\n          onSubmit: function onSubmit(submission) {\n            return _onSubmit(submission, applicationDetail, onFormSubmit, form._id);\n          },\n          options: _objectSpread({}, options),\n          onCustomEvent: onCustomEvent\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 67,\n          columnNumber: 9\n        }, _this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 66,\n        columnNumber: 11\n      }, _this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 65,\n      columnNumber: 9\n    }, _this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 55,\n    columnNumber: 7\n  }, _this);\n}, \"hmsRA73PsHUpzDCfjFcVpmuHDx4=\", false, function () {\n  return [useDispatch, useParams, useSelector, useSelector, useSelector, useSelector];\n}));\n_c2 = Edit;\nEdit.defaultProps = {\n  onCustomEvent: function onCustomEvent() {}\n};\n\nvar mapStateToProps = function mapStateToProps(state) {\n  return {\n    user: state.user.userDetail,\n    form: selectRoot('form', state),\n    submission: selectRoot('submission', state),\n    isAuthenticated: state.user.isAuthenticated,\n    errors: [selectError('form', state), selectError('submission', state)],\n    options: {\n      noAlerts: false,\n      i18n: {\n        en: {\n          error: \"Please fix the errors before submitting again.\"\n        }\n      }\n    },\n    submissionError: selectRoot('formDelete', state).formSubmissionError\n  };\n};\n\nvar mapDispatchToProps = function mapDispatchToProps(dispatch, ownProps) {\n  return {\n    onSubmit: function onSubmit(submission, applicationDetail, onFormSubmit, formId) {\n      dispatch(setFormSubmissionLoading(true));\n      dispatch(saveSubmission('submission', submission, onFormSubmit ? formId : ownProps.match.params.formId, function (err, submission) {\n        if (!err) {\n          if (UPDATE_EVENT_STATUS.includes(applicationDetail.applicationStatus)) {\n            var data = getProcessDataReq(applicationDetail);\n            dispatch(updateApplicationEvent(data, function () {\n              dispatch(resetSubmissions('submission'));\n              dispatch(setFormSubmissionLoading(false));\n\n              if (onFormSubmit) {\n                onFormSubmit();\n              } else {\n                toast.success(\"Submission Saved.\");\n                dispatch(push(\"/form/\".concat(ownProps.match.params.formId, \"/submission/\").concat(submission._id)));\n              }\n            }));\n          } else {\n            dispatch(resetSubmissions('submission'));\n            dispatch(setFormSubmissionLoading(false));\n\n            if (onFormSubmit) {\n              onFormSubmit();\n            } else {\n              toast.success(\"Submission Saved.\");\n              dispatch(push(\"/form/\".concat(ownProps.match.params.formId, \"/submission/\").concat(submission._id, \"/edit\")));\n            }\n          }\n        } else {\n          dispatch(setFormSubmissionLoading(false));\n          var ErrorDetails = {\n            modalOpen: true,\n            message: \"Submission cannot be done\"\n          };\n          toast.error(\"Error while Submission.\");\n          dispatch(setFormSubmissionError(ErrorDetails));\n        }\n      }));\n    },\n    onConfirm: function onConfirm() {\n      var ErrorDetails = {\n        modalOpen: false,\n        message: \"\"\n      };\n      dispatch(setFormSubmissionError(ErrorDetails));\n    }\n  };\n};\n\nexport default connect(mapStateToProps, mapDispatchToProps)(Edit);\n\nvar _c, _c2;\n\n$RefreshReg$(_c, \"Edit$React.memo\");\n$RefreshReg$(_c2, \"Edit\");","map":{"version":3,"sources":["C:/Users/Devin/AOT_Projects/jag-servebc/forms-flow-ai/forms-flow-web/src/components/Form/Item/Submission/Item/Edit.js"],"names":["React","useEffect","connect","useDispatch","useSelector","selectRoot","resetSubmissions","saveSubmission","Form","selectError","Errors","push","Loading","setFormSubmissionError","setFormSubmissionLoading","SubmissionError","getUserRolePermission","CLIENT","CLIENT_EDIT_STATUS","UPDATE_EVENT_STATUS","getProcessDataReq","useParams","updateApplicationEvent","LoadingOverlay","toast","Edit","memo","props","dispatch","formId","submissionId","hideComponents","onSubmit","options","errors","onFormSubmit","onCustomEvent","form","isFormActive","isActive","submission","isSubActive","url","applicationStatus","state","applications","applicationDetail","userRoles","roles","isFormSubmissionLoading","formDelete","includes","submissionError","modalOpen","message","onConfirm","title","_id","defaultProps","mapStateToProps","user","userDetail","isAuthenticated","noAlerts","i18n","en","error","formSubmissionError","mapDispatchToProps","ownProps","match","params","err","data","success","ErrorDetails"],"mappings":"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","sourcesContent":["import React, {useEffect} from 'react';\r\nimport {connect, useDispatch, useSelector} from 'react-redux'\r\nimport { selectRoot, resetSubmissions, saveSubmission, Form, selectError, Errors } from 'react-formio';\r\nimport { push } from 'connected-react-router';\r\n\r\nimport Loading from '../../../../../containers/Loading'\r\n\r\nimport {setFormSubmissionError, setFormSubmissionLoading} from '../../../../../actions/formActions';\r\nimport SubmissionError from '../../../../../containers/SubmissionError';\r\nimport {getUserRolePermission} from \"../../../../../helper/user\";\r\nimport {CLIENT} from \"../../../../../constants/constants\";\r\nimport {\r\n  CLIENT_EDIT_STATUS,\r\n  UPDATE_EVENT_STATUS,\r\n  getProcessDataReq\r\n} from \"../../../../../constants/applicationConstants\";\r\nimport {useParams} from \"react-router-dom\";\r\nimport {updateApplicationEvent} from \"../../../../../apiManager/services/applicationServices\";\r\nimport LoadingOverlay from \"react-loading-overlay\";\r\nimport {toast} from \"react-toastify\";\r\n\r\nconst Edit = React.memo((props) => {\r\n  const dispatch = useDispatch();\r\n  const {formId, submissionId} = useParams();\r\n  const {\r\n    hideComponents,\r\n    onSubmit,\r\n    options,\r\n    errors,\r\n    onFormSubmit,\r\n    onCustomEvent,\r\n    form: { form, isActive: isFormActive },\r\n    submission: { submission, isActive: isSubActive, url }\r\n  } = props;\r\n\r\n  const applicationStatus = useSelector(state => state.applications.applicationDetail?.applicationStatus || '');\r\n  const userRoles = useSelector((state) => {\r\n    return selectRoot(\"user\", state).roles;\r\n  });\r\n  const applicationDetail = useSelector(state=>state.applications.applicationDetail);\r\n  const isFormSubmissionLoading = useSelector(state=>state.formDelete.isFormSubmissionLoading);\r\n  useEffect(() => {\r\n    if (applicationStatus && !onFormSubmit) {\r\n      if (getUserRolePermission(userRoles, CLIENT) && !CLIENT_EDIT_STATUS.includes(applicationStatus)) {\r\n        dispatch(push(`/form/${formId}/submission/${submissionId}`));\r\n      }\r\n    }\r\n  }, [applicationStatus, userRoles, dispatch, submissionId, formId, onFormSubmit ]);\r\n\r\n  if ((isFormActive ||  (isSubActive && !isFormSubmissionLoading))) {\r\n      return <Loading />;\r\n  }\r\n\r\n  return (\r\n      <div className=\"container\">\r\n        <div className=\"main-header\">\r\n          <SubmissionError modalOpen={props.submissionError.modalOpen}\r\n            message={props.submissionError.message}\r\n            onConfirm={props.onConfirm}\r\n          >\r\n          </SubmissionError>\r\n          <h3 className=\"task-head\">{form.title}</h3>\r\n        </div>\r\n        <Errors errors={errors} />\r\n        <LoadingOverlay active={isFormSubmissionLoading} spinner text='Loading...' className=\"col-12\">\r\n          <div className=\"ml-4 mr-4\">\r\n        <Form\r\n          form={form}\r\n          submission={submission}\r\n          url={url}\r\n          hideComponents={hideComponents}\r\n          onSubmit={(submission)=>onSubmit(submission,applicationDetail,onFormSubmit,form._id)}\r\n          options={{ ...options }}\r\n          onCustomEvent={onCustomEvent}\r\n        />\r\n          </div>\r\n        </LoadingOverlay>\r\n      </div>\r\n    );\r\n})\r\n\r\nEdit.defaultProps = {\r\n  onCustomEvent: ()=>{}\r\n};\r\n\r\nconst mapStateToProps = (state) => {\r\n  return {\r\n    user: state.user.userDetail,\r\n    form: selectRoot('form', state),\r\n    submission: selectRoot('submission', state),\r\n    isAuthenticated: state.user.isAuthenticated,\r\n    errors: [\r\n      selectError('form', state),\r\n      selectError('submission', state),\r\n    ],\r\n    options: {\r\n      noAlerts: false,\r\n      i18n: {\r\n        en: {\r\n          error: \"Please fix the errors before submitting again.\",\r\n        },\r\n      }\r\n    },\r\n    submissionError: selectRoot('formDelete', state).formSubmissionError,\r\n  }\r\n}\r\n\r\nconst mapDispatchToProps = (dispatch, ownProps) => {\r\n  return {\r\n    onSubmit: (submission,applicationDetail, onFormSubmit, formId) => {\r\n      dispatch(setFormSubmissionLoading(true));\r\n      dispatch(saveSubmission('submission', submission, onFormSubmit?formId: ownProps.match.params.formId, (err, submission) => {\r\n        if (!err) {\r\n          if(UPDATE_EVENT_STATUS.includes(applicationDetail.applicationStatus)){\r\n            const data = getProcessDataReq(applicationDetail);\r\n            dispatch(updateApplicationEvent(data,()=>{\r\n              dispatch(resetSubmissions('submission'));\r\n              dispatch(setFormSubmissionLoading(false));\r\n              if(onFormSubmit){\r\n                onFormSubmit();\r\n              }else{\r\n                toast.success(\"Submission Saved.\");\r\n                dispatch(push(`/form/${ownProps.match.params.formId}/submission/${submission._id}`))\r\n              }\r\n            }));\r\n          }else{\r\n            dispatch(resetSubmissions('submission'));\r\n            dispatch(setFormSubmissionLoading(false));\r\n            if(onFormSubmit){\r\n             onFormSubmit();\r\n            }else{\r\n              toast.success(\"Submission Saved.\");\r\n              dispatch(push(`/form/${ownProps.match.params.formId}/submission/${submission._id}/edit`))\r\n            }\r\n          }\r\n        }\r\n        else {\r\n          dispatch(setFormSubmissionLoading(false));\r\n          const ErrorDetails = { modalOpen: true, message: \"Submission cannot be done\" }\r\n          toast.error(\"Error while Submission.\");\r\n          dispatch(setFormSubmissionError(ErrorDetails))\r\n        }\r\n      }));\r\n    },\r\n    onConfirm: () => {\r\n      const ErrorDetails = { modalOpen: false, message: \"\" }\r\n      dispatch(setFormSubmissionError(ErrorDetails))\r\n    }\r\n  }\r\n}\r\n\r\nexport default connect(\r\n  mapStateToProps,\r\n  mapDispatchToProps\r\n)(Edit)\r\n"]},"metadata":{},"sourceType":"module"}